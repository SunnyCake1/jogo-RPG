<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Eldoria: Cr√¥nicas de Sangue</title>
    <style>
        :root { --bg: #050505; --panel: #111; --accent: #ffcc00; --danger: #ff4444; --success: #2ecc71; }
        body { background: var(--bg); color: #eee; font-family: 'Cinzel', serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* ANIMA√á√ïES */
        @keyframes shake { 0% { transform: translate(1px, 1px); } 20% { transform: translate(-3px, 0px); } 40% { transform: translate(3px, 2px); } 100% { transform: translate(0,0); } }
        .shake { animation: shake 0.5s; }
        
        #game-container { display: flex; width: 100%; }
        #main-stage { flex: 3; padding: 20px; display: flex; flex-direction: column; align-items: center; position: relative; }
        
        /* IMAGEM REAL */
        #scene-image { width: 90%; height: 400px; object-fit: cover; border: 2px solid #333; border-radius: 5px; box-shadow: 0 0 20px #000; }

        /* MENSAGEM DE IMPACTO */
        #impact-overlay { position: absolute; top: 40%; font-size: 3em; font-weight: bold; text-shadow: 0 0 10px #000; display: none; z-index: 100; pointer-events: none; }

        /* NARRATIVA */
        #narrative-box { width: 90%; background: rgba(20,20,20,0.9); padding: 20px; border-radius: 5px; margin-top: -50px; border-top: 2px solid var(--accent); z-index: 10; }
        .choices-grid { display: grid; grid-template-columns: 1fr; width: 90%; margin-top: 15px; }
        .btn { background: #1a1a1a; color: #fff; border: 1px solid #444; padding: 15px; margin: 5px; cursor: pointer; transition: 0.3s; text-align: left; }
        .btn:hover { background: #333; border-color: var(--accent); }

        /* SIDEBAR */
        #sidebar { flex: 1; background: var(--panel); border-left: 2px solid #222; padding: 20px; display: flex; flex-direction: column; }
        .stat-row { display: flex; justify-content: space-between; border-bottom: 1px solid #222; padding: 8px 0; }
        
        /* INVENT√ÅRIO */
        #inventory-list { flex: 1; overflow-y: auto; margin-top: 10px; }
        .inv-item { background: #222; padding: 10px; margin-bottom: 5px; border-radius: 3px; font-size: 0.9em; display: flex; justify-content: space-between; }
        .equip-btn { background: var(--accent); color: #000; border: none; padding: 3px 8px; border-radius: 2px; cursor: pointer; }

        /* SHOP */
        #shop-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; padding: 50px; }
    </style>
</head>
<body>

    <div id="menu-screen" style="position:fixed; inset:0; background:#000; z-index:2000; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <h1 style="color:var(--accent); font-size:4em;">ELDORIA</h1>
        <button onclick="Game.init()" style="padding:20px 50px; font-size:1.5em; background:var(--accent); cursor:pointer;">INICIAR JORNADA</button>
    </div>

    <div id="impact-overlay"></div>

    <div id="game-container">
        <div id="main-stage">
            <img id="scene-image" src="" alt="Cena">
            <div id="narrative-box">
                <h2 id="scene-title" style="margin:0; color:var(--accent)">Aguardando...</h2>
                <p id="scene-text" style="line-height:1.6; font-size:1.1em;"></p>
            </div>
            <div id="choices-grid" class="choices-grid"></div>
        </div>

        <div id="sidebar">
            <h3 style="border-bottom:1px solid var(--accent)">HER√ìI</h3>
            <div class="stat-row"><span>‚ù§Ô∏è Vida</span> <span id="ui-hp">100/100</span></div>
            <div class="stat-row"><span>‚ú® Mana</span> <span id="ui-mana">50</span></div>
            <div class="stat-row"><span>‚öîÔ∏è Ataque</span> <span id="ui-atk">5</span></div>
            <div class="stat-row"><span>üí∞ Ouro</span> <span id="ui-gold" style="color:gold">50</span></div>
            <div class="stat-row"><span>üß¨ Miss√£o</span> <span id="ui-quest" style="color:var(--accent)">Pr√≥logo</span></div>
            
            <h3 style="margin-top:20px;">üéí INVENT√ÅRIO</h3>
            <div id="inventory-list"></div>
            
            <div id="game-log" style="height:150px; overflow-y:auto; font-size:0.8em; color:#666; margin-top:auto; border-top:1px solid #333; padding-top:10px;"></div>
        </div>
    </div>

<script>
// LINKS DA PLANILHA (Mantenha os mesmos)
const SHEETS = {
    EVENTOS: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYBgyb8dCSFIKTq84xLLYow8OXHiYph-PP-nb_8CsLJodJz38rZiFM4mB6FPCoiw1zDPjoFaH9Ju_6/pub?gid=1744997815&single=true&output=csv",
    ITENS: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYBgyb8dCSFIKTq84xLLYow8OXHiYph-PP-nb_8CsLJodJz38rZiFM4mB6FPCoiw1zDPjoFaH9Ju_6/pub?gid=1410748440&single=true&output=csv",
    RACAS: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYBgyb8dCSFIKTq84xLLYow8OXHiYph-PP-nb_8CsLJodJz38rZiFM4mB6FPCoiw1zDPjoFaH9Ju_6/pub?gid=295311780&single=true&output=csv",
    VILOES: "https://docs.google.com/spreadsheets/d/e/2PACX-1vQYBgyb8dCSFIKTq84xLLYow8OXHiYph-PP-nb_8CsLJodJz38rZiFM4mB6FPCoiw1zDPjoFaH9Ju_6/pub?gid=530389116&single=true&output=csv"
};

let DB = {};
let player = { 
    hp: 100, maxHp: 100, mana: 50, atk: 5, gold: 50, 
    inventory: [], equipped: null, nextEventId: "101" 
};

const Game = {
    init: async () => {
        document.getElementById('menu-screen').style.display = 'none';
        const load = async (url) => {
            const r = await fetch(url);
            const t = await r.text();
            return Game.parseCSV(t);
        };
        DB.EVENTOS = await load(SHEETS.EVENTOS);
        DB.ITENS = await load(SHEETS.ITENS);
        Game.renderScene();
    },

    parseCSV: (t) => {
        const lines = t.split("\n").filter(l => l.trim());
        const headers = lines[0].split(",").map(h => h.trim().toLowerCase());
        return lines.slice(1).map(l => {
            const v = l.split(",");
            return headers.reduce((o, h, i) => { o[h] = v[i] ? v[i].trim() : ""; return o; }, {});
        });
    },

    showImpact: (text, color) => {
        const div = document.getElementById('impact-overlay');
        div.innerText = text;
        div.style.color = color;
        div.style.display = 'block';
        setTimeout(() => div.style.display = 'none', 1500);
    },

    renderScene: () => {
        // Busca o evento espec√≠fico ou sorteia um se n√£o houver sequ√™ncia
        let ev = DB.EVENTOS.find(e => e.id === player.nextEventId);
        if(!ev) ev = DB.EVENTOS[Math.floor(Math.random() * DB.EVENTOS.length)];

        // Imagens do Unsplash (Paisagens reais)
        const kw = ev.keyword_imagem || "fantasy,forest";
        document.getElementById('scene-image').src = `https://source.unsplash.com/featured/800x450/?${kw}`;
        
        document.getElementById('scene-title').innerText = ev.titulo;
        document.getElementById('scene-text').innerText = ev.texto_base;
        
        const grid = document.getElementById('choices-grid');
        grid.innerHTML = "";

        ["opcao1", "opcao2", "opcao3"].forEach((opt, i) => {
            if(ev[opt]) {
                const b = document.createElement('button');
                b.className = "btn";
                b.innerText = ev[opt];
                b.onclick = () => Game.resolve(ev, opt, i);
                grid.appendChild(b);
            }
        });
        UI.update();
    },

    resolve: (ev, optKey, idx) => {
        const dc = parseInt(ev.dificuldade) || 0;
        const roll = Math.floor(Math.random() * 20) + 1;
        
        // Verifica se o teste de per√≠cia passa
        const success = (idx !== 0 || ev.teste_atributo === "Nenhum") ? true : roll >= dc;

        if (success) {
            Game.showImpact("SUCESSO", "var(--success)");
            // Pega o ID de destino baseado na op√ß√£o clicada (1, 2 ou 3)
            const nextKey = `id_proximo_${idx + 1}`;
            player.nextEventId = ev[nextKey] || ""; 
        } else {
            Game.showImpact("FALHA", "var(--danger)");
            player.hp -= 15;
            player.nextEventId = ""; 
        }

        UI.update();
        setTimeout(() => Game.renderScene(), 1000);
    }

        if(player.hp <= 0) alert("Morte...");
        Game.renderScene();
    }
};

const Loot = {
    get: () => {
        const item = DB.ITENS[Math.floor(Math.random() * DB.ITENS.length)];
        player.inventory.push(item);
        UI.log(`Achou: ${item.nome}`);
    }
};

const UI = {
    update: () => {
        document.getElementById('ui-hp').innerText = `${player.hp}/${player.maxHp}`;
        document.getElementById('ui-mana').innerText = player.mana;
        document.getElementById('ui-gold').innerText = player.gold;
        
        const inv = document.getElementById('inventory-list');
        inv.innerHTML = "";
        player.inventory.forEach((item, i) => {
            const div = document.createElement('div');
            div.className = "inv-item";
            div.innerHTML = `<span>${item.nome}</span>`;
            if(item.tipo === "Arma") {
                const b = document.createElement('button');
                b.className = "equip-btn";
                b.innerText = player.equipped === item ? "Equipado" : "Equipar";
                b.onclick = () => { player.equipped = item; UI.update(); };
                div.appendChild(b);
            }
            inv.appendChild(div);
        });
        
        // Atualiza Ataque
        const bonus = player.equipped ? parseInt(player.equipped.dano) : 0;
        document.getElementById('ui-atk').innerText = 5 + bonus;
    },
    log: (m) => {
        const log = document.getElementById('game-log');
        log.innerHTML = `> ${m}<br>` + log.innerHTML;
    }
};
</script>
</body>
</html>

